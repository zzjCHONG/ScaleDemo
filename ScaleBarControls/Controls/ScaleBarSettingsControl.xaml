<UserControl
    x:Class="ScaleBarControls.Controls.ScaleBarSettingsControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:ScaleBarControls.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:ScaleBarControls.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="1000"
    d:DesignWidth="400"
    mc:Ignorable="d">

    <UserControl.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter" />
        <converters:FontWeightConverter x:Key="FontWeightConverter" />
    </UserControl.Resources>

    <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="10" Orientation="Vertical">

            <!--  标题  -->
            <TextBlock
                Margin="0,0,0,15"
                HorizontalAlignment="Center"
                FontSize="16"
                FontWeight="Bold"
                Text="比例尺设置" />

            <!--  图像加载区域  -->
            <GroupBox Margin="0,0,0,10" Header="图像控制">
                <StackPanel>
                    <Button
                        Height="30"
                        Margin="5"
                        Click="LoadImageButton_Click"
                        Content="加载图片" />
                    <TextBlock Margin="5,5,5,0" Text="{Binding ViewModel.IsImageLoaded, StringFormat='图片已加载: {0}'}" />
                    <TextBlock Margin="5,0,5,5" Text="{Binding ViewModel.ImagePanelScale, StringFormat='当前缩放: {0:F2}'}" />
                    <Button
                        Height="25"
                        Margin="5,0,5,5"
                        Command="{Binding ViewModel.ResetScaleSettingsCommand}"
                        Content="重置视图" />
                </StackPanel>
            </GroupBox>

            <!--  预设配置  -->
            <GroupBox Margin="0,0,0,10" Header="预设配置">
                <ItemsControl ItemsSource="{Binding PresetConfigs}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <UniformGrid Columns="2" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Button
                                Height="25"
                                Margin="2"
                                Click="ApplyPresetButton_Click"
                                Content="{Binding Name}"
                                Tag="{Binding Key}"
                                ToolTip="{Binding Description}" />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </GroupBox>

            <!--  缩放和平移设置  -->
            <GroupBox Margin="0,0,0,10" Header="缩放和平移设置">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="60" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock
                        Grid.Row="0"
                        Grid.Column="0"
                        Margin="5"
                        VerticalAlignment="Center"
                        Text="最小缩放:" />
                    <Slider
                        Grid.Row="0"
                        Grid.Column="1"
                        Margin="5"
                        IsSnapToTickEnabled="True"
                        Maximum="2.0"
                        Minimum="0.1"
                        TickFrequency="0.1"
                        Value="{Binding ViewModel.MinScale}" />
                    <TextBox
                        Grid.Row="0"
                        Grid.Column="2"
                        Margin="5"
                        Text="{Binding ViewModel.MinScale, StringFormat=F1}" />

                    <TextBlock
                        Grid.Row="1"
                        Grid.Column="0"
                        Margin="5"
                        VerticalAlignment="Center"
                        Text="最大缩放:" />
                    <Slider
                        Grid.Row="1"
                        Grid.Column="1"
                        Margin="5"
                        IsSnapToTickEnabled="True"
                        Maximum="50"
                        Minimum="5"
                        TickFrequency="1"
                        Value="{Binding ViewModel.MaxScale}" />
                    <TextBox
                        Grid.Row="1"
                        Grid.Column="2"
                        Margin="5"
                        Text="{Binding ViewModel.MaxScale, StringFormat=F0}" />

                    <TextBlock
                        Grid.Row="2"
                        Grid.Column="0"
                        Margin="5"
                        VerticalAlignment="Center"
                        Text="平移敏感度:" />
                    <Slider
                        Grid.Row="2"
                        Grid.Column="1"
                        Margin="5"
                        IsSnapToTickEnabled="True"
                        Maximum="3.0"
                        Minimum="0.5"
                        TickFrequency="0.1"
                        Value="{Binding ViewModel.PanSensitivity}" />
                    <TextBox
                        Grid.Row="2"
                        Grid.Column="2"
                        Margin="5"
                        Text="{Binding ViewModel.PanSensitivity, StringFormat=F1}" />
                </Grid>
            </GroupBox>

            <!--  比例尺显示设置  -->
            <GroupBox Margin="0,0,0,10" Header="显示设置">
                <StackPanel>
                    <CheckBox
                        Margin="5"
                        Content="显示比例尺"
                        IsChecked="{Binding ViewModel.IsScaleBarVisible}" />

                    <Grid Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Grid.Column="0"
                            VerticalAlignment="Center"
                            Text="位置:" />
                        <ComboBox
                            Grid.Row="0"
                            Grid.Column="1"
                            Margin="5,0"
                            ItemsSource="{Binding PositionOptions}"
                            SelectedItem="{Binding ViewModel.Position}" />

                        <TextBlock
                            Grid.Row="1"
                            Grid.Column="0"
                            VerticalAlignment="Center"
                            Text="绘制模式:" />
                        <ComboBox
                            Grid.Row="1"
                            Grid.Column="1"
                            Margin="5,0"
                            ItemsSource="{Binding DrawModeOptions}"
                            SelectedItem="{Binding ViewModel.DrawMode}" />
                    </Grid>
                </StackPanel>
            </GroupBox>

            <!--  比例尺模式切换  -->
            <GroupBox Margin="0,0,0,10" Header="比例尺模式">
                <StackPanel>
                    <RadioButton
                        Margin="5"
                        Content="使用真实比例尺"
                        GroupName="ScaleMode"
                        IsChecked="{Binding ViewModel.IsSetScaleMode}" />
                    <RadioButton
                        Margin="5"
                        Content="使用像素长度"
                        GroupName="ScaleMode"
                        IsChecked="{Binding ViewModel.IsSetScaleMode, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Invert}" />
                </StackPanel>
            </GroupBox>

            <!--  真实比例尺设置  -->
            <GroupBox
                Margin="0,0,0,10"
                Header="真实比例尺设置"
                Visibility="{Binding ViewModel.IsSetScaleMode, Converter={StaticResource BoolToVisibilityConverter}}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock
                        Grid.Row="0"
                        Grid.Column="0"
                        Margin="5"
                        VerticalAlignment="Center"
                        Text="水平数值:" />
                    <TextBox
                        Grid.Row="0"
                        Grid.Column="1"
                        Margin="5"
                        Text="{Binding ViewModel.WidthinUnit}" />

                    <TextBlock
                        Grid.Row="1"
                        Grid.Column="0"
                        Margin="5"
                        VerticalAlignment="Center"
                        Text="垂直数值:" />
                    <TextBox
                        Grid.Row="1"
                        Grid.Column="1"
                        Margin="5"
                        Text="{Binding ViewModel.HeightinUnit}" />

                    <TextBlock
                        Grid.Row="2"
                        Grid.Column="0"
                        Margin="5"
                        VerticalAlignment="Center"
                        Text="比例尺:" />
                    <TextBox
                        Grid.Row="2"
                        Grid.Column="1"
                        Margin="5"
                        Text="{Binding ViewModel.Scale}" />

                    <TextBlock
                        Grid.Row="3"
                        Grid.Column="0"
                        Margin="5"
                        VerticalAlignment="Center"
                        Text="像素宽高比:" />
                    <TextBox
                        Grid.Row="3"
                        Grid.Column="1"
                        Margin="5"
                        Text="{Binding ViewModel.PixelAspectRatio}" />

                    <TextBlock
                        Grid.Row="4"
                        Grid.Column="0"
                        Margin="5"
                        VerticalAlignment="Center"
                        Text="单位:" />
                    <ComboBox
                        Grid.Row="4"
                        Grid.Column="1"
                        Margin="5"
                        IsEditable="True"
                        ItemsSource="{Binding UnitOptions}"
                        SelectedItem="{Binding ViewModel.Unit}" />
                </Grid>
            </GroupBox>

            <!--  像素长度设置  -->
            <GroupBox
                Margin="0,0,0,10"
                Header="像素长度设置"
                Visibility="{Binding ViewModel.IsSetScaleMode, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Invert}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock
                        Grid.Row="0"
                        Grid.Column="0"
                        Margin="5"
                        VerticalAlignment="Center"
                        Text="水平长度:" />
                    <TextBox
                        Grid.Row="0"
                        Grid.Column="1"
                        Margin="5"
                        Text="{Binding ViewModel.ScaleLengthWidth}" />

                    <TextBlock
                        Grid.Row="1"
                        Grid.Column="0"
                        Margin="5"
                        VerticalAlignment="Center"
                        Text="垂直长度:" />
                    <TextBox
                        Grid.Row="1"
                        Grid.Column="1"
                        Margin="5"
                        Text="{Binding ViewModel.ScaleLengthHeight}" />
                </Grid>
            </GroupBox>

            <!--  外观设置  -->
            <GroupBox Margin="0,0,0,10" Header="外观设置">
                <StackPanel>
                    <!--  字体设置  -->
                    <Grid Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Grid.Column="0"
                            Margin="0,0,10,0"
                            VerticalAlignment="Center"
                            Text="字体大小:" />
                        <StackPanel
                            Grid.Row="0"
                            Grid.Column="1"
                            Orientation="Horizontal">
                            <Slider
                                Width="120"
                                VerticalAlignment="Center"
                                Maximum="32"
                                Minimum="8"
                                Value="{Binding ViewModel.FontSize}" />
                            <TextBox
                                Width="40"
                                Margin="10,0,0,0"
                                Text="{Binding ViewModel.FontSize}" />
                        </StackPanel>

                        <TextBlock
                            Grid.Row="1"
                            Grid.Column="0"
                            Margin="0,0,10,0"
                            VerticalAlignment="Center"
                            Text="线宽:" />
                        <StackPanel
                            Grid.Row="1"
                            Grid.Column="1"
                            Orientation="Horizontal">
                            <Slider
                                Width="120"
                                VerticalAlignment="Center"
                                Maximum="10"
                                Minimum="1"
                                Value="{Binding ViewModel.LineWidth}" />
                            <TextBox
                                Width="40"
                                Margin="10,0,0,0"
                                Text="{Binding ViewModel.LineWidth}" />
                        </StackPanel>

                        <TextBlock
                            Grid.Row="2"
                            Grid.Column="0"
                            Margin="0,0,10,0"
                            VerticalAlignment="Center"
                            Text="字体系列:" />
                        <ComboBox
                            Grid.Row="2"
                            Grid.Column="1"
                            IsEditable="True"
                            ItemsSource="{Binding FontFamilyOptions}"
                            SelectedItem="{Binding ViewModel.FontFamily}" />

                        <TextBlock
                            Grid.Row="3"
                            Grid.Column="0"
                            Margin="0,0,10,0"
                            VerticalAlignment="Center"
                            Text="字体可见性:" />
                        <ComboBox
                            Grid.Row="3"
                            Grid.Column="1"
                            ItemsSource="{Binding FontVisibilityOptions}"
                            SelectedItem="{Binding ViewModel.FontVisibility, Converter={StaticResource StringToVisibilityConverter}}" />
                    </Grid>

                    <!--  颜色设置  -->
                    <StackPanel Margin="5" Orientation="Horizontal">
                        <Button
                            Width="100"
                            Height="30"
                            Margin="0,0,10,0"
                            Click="SelectTextColorButton_Click"
                            Content="选择文字颜色" />
                        <Rectangle
                            Width="30"
                            Height="30"
                            Fill="{Binding ViewModel.TextBrush}"
                            Stroke="Black"
                            StrokeThickness="1" />
                    </StackPanel>

                    <StackPanel Margin="5" Orientation="Horizontal">
                        <Button
                            Width="100"
                            Height="30"
                            Margin="0,0,10,0"
                            Click="SelectBackgroundColorButton_Click"
                            Content="选择背景颜色" />
                        <Rectangle
                            Width="30"
                            Height="30"
                            Fill="{Binding ViewModel.BackgroundBrush}"
                            Stroke="Black"
                            StrokeThickness="1" />
                    </StackPanel>

                    <!--  字体粗细  -->
                    <StackPanel Margin="5" Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,10,0"
                            VerticalAlignment="Center"
                            Text="字体粗细:" />
                        <CheckBox Content="粗体" IsChecked="{Binding ViewModel.FontWeight, Converter={StaticResource FontWeightConverter}}" />
                    </StackPanel>
                </StackPanel>
            </GroupBox>

        </StackPanel>
    </ScrollViewer>

</UserControl>
