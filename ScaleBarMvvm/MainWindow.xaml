<Window
    x:Class="ScaleBarMvvm.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:ScaleBarMvvm"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:ScaleBarMvvm"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="MainWindow"
    Width="800"
    Height="1000"
    d:DataContext="{d:DesignInstance local:MainViewModel}"
    mc:Ignorable="d">

    <!--<Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <controls:ScaleBarUserControl
            x:Name="ScaleBar"
            Grid.Column="0"
            ImageSource="{Binding CurrentImage}" />

        <controls:ScaleBarSettingsControl Grid.Column="1" ViewModel="{Binding ElementName=ScaleBar, Path=ViewModel}" />
    </Grid>-->

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  调试信息栏  -->
        <StackPanel
            Grid.Row="0"
            Grid.ColumnSpan="2"
            Margin="5"
            Background="LightCyan">
            <TextBlock
                Margin="5"
                FontWeight="Bold"
                Text="{Binding ImageInfo, StringFormat='MainWindow ViewModel CurrentImage: {0}'}" />
            <StackPanel Margin="5" Orientation="Horizontal">
                <Button
                    Margin="0,0,10,0"
                    Padding="10,5"
                    Click="LoadImage_Click"
                    Content="加载图片" />
                <Button
                    Margin="0,0,10,0"
                    Padding="10,5"
                    Click="CreateTestImage_Click"
                    Content="创建测试图片" />
                <Button
                    Margin="0,0,10,0"
                    Padding="10,5"
                    Click="ClearImage_Click"
                    Content="清空图片" />
                <Button
                    Margin="0,0,10,0"
                    Padding="10,5"
                    Click="DebugInfo_Click"
                    Content="调试信息" />
            </StackPanel>
        </StackPanel>

        <!--  左侧：用户控件显示区域  -->
        <StackPanel
            Grid.Row="1"
            Grid.Column="0"
            Margin="10">
            <TextBlock
                Margin="0,0,0,5"
                FontWeight="Bold"
                Text="ScaleBarUserControl 显示区域:" />

            <!--<controls:ScaleBarUserControl
                x:Name="ScaleBarControl"
                Height="300"
                Background="LightGray"
                ImageSource="{Binding CurrentImage}" />-->

            <controls:ScaleBarUserControl x:Name="ScaleBarControl" ImageSource="{Binding DataContext.CurrentImage, RelativeSource={RelativeSource AncestorType=Window}}" />

            <!--  直接绑定测试  -->
            <TextBlock
                Margin="0,20,0,5"
                FontWeight="Bold"
                Text="直接Image控件测试:" />
            <Image
                Height="200"
                HorizontalAlignment="Left"
                Source="{Binding CurrentImage}"
                Stretch="Uniform" />
        </StackPanel>

        <!--  右侧：设置和调试信息  -->
        <StackPanel
            Grid.Row="1"
            Grid.Column="1"
            Margin="10">
            <TextBlock
                Margin="0,0,0,5"
                FontWeight="Bold"
                Text="绑定调试信息:" />

            <Border
                Padding="10"
                Background="White"
                BorderBrush="Gray"
                BorderThickness="1">
                <StackPanel>
                    <TextBlock
                        Margin="0,0,0,5"
                        Text="{Binding ElementName=ScaleBarControl, Path=ViewModel.ImageInfo, StringFormat='UserControl ImageInfo: {0}'}"
                        TextWrapping="Wrap" />

                    <TextBlock Margin="0,0,0,5" Text="{Binding ElementName=ScaleBarControl, Path=ViewModel.FontSize, StringFormat='UserControl FontSize: {0}'}" />

                    <Separator Margin="0,10" />

                    <TextBlock
                        Margin="0,0,0,5"
                        FontWeight="Bold"
                        Text="设置测试:" />

                    <StackPanel Margin="0,5" Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,10,0"
                            VerticalAlignment="Center"
                            Text="字体大小:" />
                        <TextBox Width="60" Text="{Binding ElementName=ScaleBarControl, Path=ViewModel.FontSize, Mode=TwoWay}" />
                    </StackPanel>

                    <CheckBox
                        Margin="0,5"
                        Content="显示比例尺"
                        IsChecked="{Binding ElementName=ScaleBarControl, Path=ViewModel.IsScaleBarVisible, Mode=TwoWay}" />

                    <StackPanel Margin="0,5" Orientation="Horizontal">
                        <TextBlock
                            Margin="0,0,10,0"
                            VerticalAlignment="Center"
                            Text="单位:" />
                        <TextBox Width="60" Text="{Binding ElementName=ScaleBarControl, Path=ViewModel.Unit, Mode=TwoWay}" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </StackPanel>
    </Grid>


</Window>
